;;; -*- Lisp -*-
(load "script-support")
(load-asdf)
(quit-on-error
 (format t "test2 1~%")
 (setf asdf:*central-registry* '(*default-pathname-defaults*))
                                        ;(trace asdf::perform)
                                        ;(trace asdf::find-component)
                                        ;(trace asdf::traverse)
 (asdf:oos 'asdf:load-op 'test2b1)
 (format t "test2 2~%")
 (assert (and (probe-file (asdf:compile-file-pathname* (truename "file3.lisp")))
              (probe-file (asdf:compile-file-pathname* (truename "file4.lisp")))))
 (format t "test2 3~%")
 (handler-case
     (asdf:oos 'asdf:load-op 'test2b2)
   (asdf:missing-dependency (c)
     (format t "load failed as expected: - ~%~A~%" c))
   (:no-error (c)
     (declare (ignore c))
     (error "should have failed, oops")))
 (format t "test2 4~%")
 (handler-case
     (asdf:oos 'asdf:load-op 'test2b3)
   (asdf:missing-dependency (c)
     (format t "load failed as expected: - ~%~A~%" c))
   (:no-error (c)
     (declare (ignore c))
     (error "should have failed, oops"))))
